<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic LLM Bayesian Network</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/cytoscape@3.23.0/dist/cytoscape.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/webcola@3.4.0/WebCola/cola.min.js"></script>
    <script src="https://unpkg.com/cytoscape-cola@2.5.1/cytoscape-cola.js"></script>
    <script src="https://unpkg.com/cytoscape-dagre@2.5.0/cytoscape-dagre.js"></script>
    <!-- PapaParse for client-side CSV generation -->
    <script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>

    <script>
        // Layout registration (unchanged)
        console.log("Attempting to register Cytoscape Cola layout...");
        if (typeof window.cola !== 'undefined' && typeof window.cytoscapeCola === 'function') {
            try { cytoscape.use(cytoscapeCola); console.log("SUCCESS: Registered Cytoscape Cola layout."); }
            catch (e) { console.error("ERROR: Failed to register Cytoscape Cola layout:", e); }
        } else { console.warn("Cola or cytoscapeCola not available. Will attempt dagre."); }
        if (typeof window.cytoscapeDagre === 'function') {
            try { cytoscape.use(cytoscapeDagre); console.log("SUCCESS: Registered Cytoscape Dagre layout."); }
            catch (e) { console.error("ERROR: Failed to register Cytoscape Dagre layout:", e); }
        } else { console.warn("Cytoscape Dagre not available."); }
    </script>
</head>
<body>
    <h1>Dynamic LLM-Powered Cognitive Network</h1>

    <div class="config-manager">
        <h2>Configuration Management</h2>
        <label for="config-name">Config Name:</label>
        <input type="text" id="config-name" placeholder="Enter name to save">
        <button id="save-config-button">Save Current Config</button>
        <br>
        <label for="load-config-select">Load Config:</label>
        <select id="load-config-select">
            <option value="">-- Select a config --</option>
        </select>
        <button id="load-config-button">Load Selected Config</button>
        <p id="config-status"></p>
    </div>

    <div class="controls">
        <h2>Inputs (Probabilities 0.0 - 1.0)</h2>
        <div id="input-controls-container">
            <!-- Input controls will be generated dynamically here -->
            <p>Load a configuration or define a graph to see inputs.</p>
        </div>
        <label for="gradient-toggle">Enable Gradient Coloring:</label>
        <input type="checkbox" id="gradient-toggle" checked><br>
        <button id="update-button">Update Probabilities</button>
    </div>

    <div id="cy"></div>

    <div class="logging-controls">
      <h2>Session Logging</h2>
       <p>Current Config: <strong id="current-config-name">None</strong></p>
      <button id="download-session-log-button">Download Current Session Log (CSV)</button>
      <p id="log-count">Log entries this session: 0</p>
    </div>

    <div class="llm-context">
        <h2>LLM Context (Provided to the Model)</h2>
        <div id="input-context">
            <h3>Input States Provided:</h3>
            <p>Run prediction to see context.</p>
        </div>
        <div id="structure-context">
            <h3>Node Dependencies (DAG):</h3>
            <p>Run prediction to see context.</p>
        </div>
        <div id="rules-context">
            <h3>Qualitative Rules Provided:</h3>
            <p>Run prediction to see context.</p>
        </div>
        <div id="node-descriptions-context">
            <h3>Node Descriptions:</h3>
            <p>Run prediction to see context.</p>
        </div>
    </div>

     <!-- Placeholder for Graph Editing UI (Requirement 1 - Deferred) -->
    <div class="graph-editor-placeholder">
        <h2>Graph Editor (Future Feature)</h2>
        <p>Functionality to add/remove nodes and edges directly in the UI will be added later.</p>
        <p>Currently, define graphs by modifying and saving configurations, or load existing ones.</p>
        </div>

    <script src="script.js"></script>
</body>
</html>
